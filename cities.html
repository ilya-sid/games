<!doctype html>
<html lang="ru" data-theme="system">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>–ò–≥—Ä–∞ ¬´–ì–æ—Ä–æ–¥–∞¬ª</title>
<style>
  :root{
    --bg:#0f1320; --card:#161a2b; --text:#e7eaf6; --muted:#a9b0c7; --accent:#5b7cfa;
    --ok:#16a34a; --bad:#dc2626; --border:rgba(255,255,255,.12); --input:#0f1629;
  }
  @media (prefers-color-scheme: light){
    :root{ --bg:#f6f7fb; --card:#ffffff; --text:#0f1222; --muted:#4f5b78; --accent:#3b82f6;
           --ok:#15803d; --bad:#b91c1c; --border:rgba(0,0,0,.12); --input:#ffffff; }
  }
  html[data-theme="light"]{ --bg:#f6f7fb; --card:#ffffff; --text:#0f1222; --muted:#4f5b78; --accent:#3b82f6; --ok:#15803d; --bad:#b91c1c; --border:rgba(0,0,0,.12); --input:#ffffff; }
  html[data-theme="dark"] { --bg:#0f1320; --card:#161a2b; --text:#e7eaf6; --muted:#a9b0c7; --accent:#5b7cfa; --ok:#16a34a; --bad:#dc2626; --border:rgba(255,255,255,.12); --input:#0f1629; }

  *{box-sizing:border-box}
  body{margin:0; background:var(--bg); color:var(--text); font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial}
  .wrap{max-width:980px; margin-inline:auto; padding:20px}
  .card{background:var(--card); border:1px solid var(--border); border-radius:16px; padding:18px; position:relative}
  h1{margin:0 0 8px; font-size:clamp(22px,4vw,32px)}
  .sub{color:var(--muted); margin:0 0 16px}
  .row{display:grid; grid-template-columns:1fr auto; gap:10px; align-items:center}
  input[type="text"]{width:100%; font-size:clamp(18px,3.5vw,22px); padding:14px 16px; border-radius:12px; border:2px solid transparent; background:var(--input); color:var(--text); outline:none; transition:.15s}
  input.ok{border-color:var(--ok); box-shadow:0 0 0 4px color-mix(in oklab, var(--ok) 18%, transparent)}
  input.bad{border-color:var(--bad); box-shadow:0 0 0 4px color-mix(in oklab, var(--bad) 18%, transparent)}
  button{background:var(--accent); color:#fff; border:0; padding:12px 16px; border-radius:12px; font-weight:700; cursor:pointer}
  button.secondary{background:transparent; color:var(--text); border:1px solid var(--border)}
  .status{margin-top:10px; min-height:24px}
  .badge{display:inline-block; padding:4px 8px; border-radius:999px; font-weight:700; font-size:13px; border:1px solid var(--border); background:rgba(127,127,127,.08); color:var(--muted)}
  .grid{display:grid; grid-template-columns:repeat(2,minmax(280px,1fr)); gap:12px; margin-top:12px}
  .panel{display:flex; gap:10px; align-items:center; flex-wrap:wrap}
  .log{max-height:300px; overflow:auto; padding:12px; border:1px solid var(--border); border-radius:12px; background:var(--card)}
  .log p{margin:6px 0}
  .pill{display:inline-block; padding:4px 8px; border-radius:10px; background:rgba(127,127,127,.08); border:1px solid var(--border); font-size:13px; color:var(--muted)}
  .scores{display:flex; gap:10px; align-items:center}
  .scores b{font-size:18px}
  .hintBlock{margin-top:8px}
  .hintText{color:var(--muted); font-size:14px; display:none}
  .hintText.show{display:block}
  @media (max-width:720px){ .grid{grid-template-columns:1fr} }

  /* ===== –í—ã–ø–∞–¥–∞—é—â–µ–µ –º–µ–Ω—é (–ò–≥—Ä—ã + –¢–µ–º–∞) ===== */
  .menu{position:fixed; right:12px; top:12px; z-index:10}
  .menu summary{
    list-style:none; cursor:pointer; background:var(--accent); color:#fff; border:0;
    padding:8px 12px; border-radius:12px; font-weight:700; box-shadow:0 6px 16px rgba(0,0,0,.25)
  }
  .menu summary::-webkit-details-marker{display:none}
  .menu[open] summary{filter:brightness(.95)}
  .menuPanel{
    margin-top:8px; right:0; position:absolute; min-width:240px;
    background:var(--card); border:1px solid var(--border); border-radius:14px; padding:10px;
    box-shadow:0 16px 40px rgba(0,0,0,.35)
  }
  .menu h4{margin:6px 8px; font-size:13px; color:var(--muted); text-transform:uppercase; letter-spacing:.06em}
  .menu nav a{display:block; padding:8px 10px; color:var(--text); text-decoration:none; border-radius:10px}
  .menu nav a:hover{background:rgba(127,127,127,.12)}
  .themeRow{display:grid; gap:8px; padding:6px 8px 4px}
  .themeRow select{background:transparent; color:var(--text); border:1px solid var(--border); border-radius:10px; padding:8px 10px}
  @media (prefers-color-scheme: light){
    html[data-theme="light"] .themeRow select{border:1px solid #ccc; background:#fff; color:#000}
  }
</style>
</head>
<body>

<!-- –í—ã–ø–∞–¥–∞—é—â–µ–µ –º–µ–Ω—é: —Å—Å—ã–ª–∫–∏ –Ω–∞ –∏–≥—Ä—ã + —Ç–µ–º–∞ -->
<details class="menu">
  <summary>–ú–µ–Ω—é ‚ñæ</summary>
  <div class="menuPanel" role="menu">
    <h4>–ò–≥—Ä—ã</h4>
    <nav>
      <a href="index.html">üßÆ –ü—Ä–∏–º–µ—Ä—ã (—Ç—Ä–µ–Ω–∞–∂—ë—Ä)</a>
      <a href="battleship.html">üö¢ –ú–æ—Ä—Å–∫–æ–π –±–æ–π</a>
      <a href="cities.html">üåç –ì–æ—Ä–æ–¥–∞</a>
      <a href="minesweeper.html">üí£ –°–∞–ø—ë—Ä</a>
      <a href="tictactoe.html">‚ùå‚≠ï –ö—Ä–µ—Å—Ç–∏–∫–∏-–Ω–æ–ª–∏–∫–∏</a>
    </nav>
    <h4>–¢–µ–º–∞</h4>
    <div class="themeRow">
      <select id="theme" aria-label="–¢–µ–º–∞">
        <option value="light">–°–≤–µ—Ç–ª–∞—è</option>
        <option value="dark">–¢—ë–º–Ω–∞—è</option>
        <option value="system" selected>–ö–∞–∫ –Ω–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ</option>
      </select>
    </div>
  </div>
</details>

  <div class="wrap">
    <div class="card">
      <h1>–ò–≥—Ä–∞ ¬´–ì–æ—Ä–æ–¥–∞¬ª</h1>
      <div class="sub">–ü–∏—à–∏ –≥–æ—Ä–æ–¥ –Ω–∞ <b>–ø–æ—Å–ª–µ–¥–Ω—é—é –±—É–∫–≤—É</b> –≥–æ—Ä–æ–¥–∞ –∫–æ–º–ø—å—é—Ç–µ—Ä–∞. –¢–æ–ª—å–∫–æ —Ä–µ–∞–ª—å–Ω—ã–µ –≥–æ—Ä–æ–¥–∞ –º–∏—Ä–∞ –Ω–∞ —Ä—É—Å—Å–∫–æ–º. –ë–µ–∑ –ø–æ–≤—Ç–æ—Ä–æ–≤.</div>

      <div class="panel">
        <span class="scores">
          <span class="pill">–°—á—ë—Ç: <b id="score">0</b></span>
          <span class="pill">–†–µ–∫–æ—Ä–¥: <b id="best">0</b></span>
        </span>
        <span class="pill">–¢–µ–∫—É—â–∞—è –±—É–∫–≤–∞: <b id="need">‚Äî</b></span>
        <button id="newGame" class="secondary">–ù–æ–≤–∞—è –∏–≥—Ä–∞</button>
      </div>

      <div class="row" style="margin-top:10px">
        <input id="input" type="text" placeholder="–í–∞—à –≥–æ—Ä–æ–¥ (–Ω–∞ —Ä—É—Å—Å–∫–æ–º)" autocomplete="off" />
        <button id="submit">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
      </div>
      <div class="status" id="status"></div>

      <div class="grid">
        <div class="card" style="padding:12px">
          <div class="badge">–•–æ–¥ –∫–æ–º–ø—å—é—Ç–µ—Ä–∞</div>
          <div style="font-size:20px; margin-top:6px"><b id="lastComp">‚Äî</b></div>
          <div class="hintBlock">
            <button id="toggleHints" class="secondary" style="padding:6px 10px; font-size:14px">–ü–æ–∫–∞–∑–∞—Ç—å –ø–æ–¥—Å–∫–∞–∑–∫–∏</button>
            <div class="hintText" id="lastChain"></div>
          </div>
        </div>
        <div class="card log">
          <div class="badge">–ò—Å—Ç–æ—Ä–∏—è</div>
          <div id="history"></div>
        </div>
      </div>
    </div>
  </div>

<script>
(()=>{
  // ====== –ë–ê–ó–ê –ì–û–†–û–î–û–í ======
  const RU = [
    "–º–æ—Å–∫–≤–∞","—Å–∞–Ω–∫—Ç-–ø–µ—Ç–µ—Ä–±—É—Ä–≥","–Ω–æ–≤–æ—Å–∏–±–∏—Ä—Å–∫","–µ–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥","–Ω–∏–∂–Ω–∏–π –Ω–æ–≤–≥–æ—Ä–æ–¥","–∫–∞–∑–∞–Ω—å","—á–µ–ª—è–±–∏–Ω—Å–∫","–æ–º—Å–∫","—Å–∞–º–∞—Ä–∞",
    "—Ä–æ—Å—Ç–æ–≤-–Ω–∞-–¥–æ–Ω—É","—É—Ñ–∞","–∫—Ä–∞—Å–Ω–æ—è—Ä—Å–∫","–ø–µ—Ä–º—å","–≤–æ—Ä–æ–Ω–µ–∂","–≤–æ–ª–≥–æ–≥—Ä–∞–¥","–∫—Ä–∞—Å–Ω–æ–¥–∞—Ä","—Å–∞—Ä–∞—Ç–æ–≤","—Ç—é–º–µ–Ω—å","—Ç–æ–ª—å—è—Ç—Ç–∏",
    "–∏–∂–µ–≤—Å–∫","–±–∞—Ä–Ω–∞—É–ª","—É–ª—å—è–Ω–æ–≤—Å–∫","–∏—Ä–∫—É—Ç—Å–∫","—Ö–∞–±–∞—Ä–æ–≤—Å–∫","—è—Ä–æ—Å–ª–∞–≤–ª—å","–≤–ª–∞–¥–∏–≤–æ—Å—Ç–æ–∫","–º–∞—Ö–∞—á–∫–∞–ª–∞","—Ç–æ–º—Å–∫","–æ—Ä–µ–Ω–±—É—Ä–≥",
    "–∫–µ–º–µ—Ä–æ–≤–æ","–Ω–æ–≤–æ–∫—É–∑–Ω–µ—Ü–∫","—Ä—è–∑–∞–Ω—å","–∞—Å—Ç—Ä–∞—Ö–∞–Ω—å","–ø–µ–Ω–∑–∞","–ª–∏–ø–µ—Ü–∫","–∫–∏—Ä–æ–≤","—á–µ–±–æ–∫—Å–∞—Ä—ã","–∫–∞–ª–∏–Ω–∏–Ω–≥—Ä–∞–¥","–∫—É—Ä—Å–∫","—Ç—É–ª–∞",
    "—Å–µ–≤–∞—Å—Ç–æ–ø–æ–ª—å","—Å—Ç–∞–≤—Ä–æ–ø–æ–ª—å","–±—Ä—è–Ω—Å–∫","—Ç–≤–µ—Ä—å","–º–∞–≥–Ω–∏—Ç–æ–≥–æ—Ä—Å–∫","–∏–≤–∞–Ω–æ–≤–æ","–±–µ–ª–≥–æ—Ä–æ–¥","—Å–æ—á–∏","—Å–º–æ–ª–µ–Ω—Å–∫","–∫–∞–ª—É–≥–∞",
    "—á–µ—Ä–µ–ø–æ–≤–µ—Ü","–∞—Ä—Ö–∞–Ω–≥–µ–ª—å—Å–∫","–≤–ª–∞–¥–∏–º–∏—Ä","—è–∫—É—Ç—Å–∫","–Ω–∞–ª—å—á–∏–∫","–∫—É—Ä–≥–∞–Ω","—Å—É—Ä–≥—É—Ç","–≤–æ–ª–æ–≥–¥–∞","–ø—Å–∫–æ–≤","—Ç–∞–º–±–æ–≤","–º—É—Ä–º–∞–Ω—Å–∫",
    "–æ—Ä—ë–ª","–º–∞–π–∫–æ–ø","–≥—Ä–æ–∑–Ω—ã–π","—Å—ã–∫—Ç—ã–≤–∫–∞—Ä","–∫–æ—Å—Ç—Ä–æ–º–∞","–ø–µ—Ç—Ä–æ–∑–∞–≤–æ–¥—Å–∫","—ç–ª–∏—Å—Ç–∞","—á–∏—Ç–∞","—É–ª–∞–Ω-—É–¥—ç","–∞–±–∞–∫–∞–Ω","–Ω–∞–±–µ—Ä–µ–∂–Ω—ã–µ —á–µ–ª–Ω—ã",
    "–π–æ—à–∫–∞—Ä-–æ–ª–∞","—Å–∞—Ä–∞–Ω—Å–∫","–±–∏—Ä–æ–±–∏–¥–∂–∞–Ω","–∞–Ω–∞–ø–∞","–∞—Ä–∑–∞–º–∞—Å","–±–∞–ª–∞–∫–æ–≤–æ","–±–ª–∞–≥–æ–≤–µ—â–µ–Ω—Å–∫","–≤–µ–ª–∏–∫–∏–π –Ω–æ–≤–≥–æ—Ä–æ–¥","–≤–µ–ª–∏–∫–∏–µ –ª—É–∫–∏",
    "–≤–ª–∞–¥–∏–∫–∞–≤–∫–∞–∑","–≥–∞—Ç—á–∏–Ω–∞","–≥–µ–ª–µ–Ω–¥–∂–∏–∫","–¥–µ—Ä–±–µ–Ω—Ç","–¥–∑–µ—Ä–∂–∏–Ω—Å–∫","–¥–æ–ª–≥–æ–ø—Ä—É–¥–Ω—ã–π","–¥—É–±–Ω–∞","–µ–ª–∞–±—É–≥–∞","–µ—Å—Å–µ–Ω—Ç—É–∫–∏","–∑–ª–∞—Ç–æ—É—Å—Ç",
    "–∫–∞–º–µ–Ω—Å–∫-—É—Ä–∞–ª—å—Å–∫–∏–π","–∫–∞–º—ã—à–∏–Ω","–∫–∞–Ω—Å–∫","–∫–æ–≤—Ä–æ–≤","–∫–æ–ª–æ–º–Ω–∞","–∫–æ–º—Å–æ–º–æ–ª—å—Å–∫-–Ω–∞-–∞–º—É—Ä–µ","–∫–æ–ø–µ–π—Å–∫","–∫–æ—Ä–æ–ª—ë–≤","–∫–æ—Ç–ª–∞—Å",
    "–∫—Ä–∞—Å–Ω–æ–≥–æ—Ä—Å–∫","–ª–µ–Ω–∏–Ω—Å–∫-–∫—É–∑–Ω–µ—Ü–∫–∏–π","–ª–µ—Å–æ—Å–∏–±–∏—Ä—Å–∫","–º–∞–≥–∞–¥–∞–Ω","–º—ã—Ç–∏—â–∏","–Ω–∞–¥—ã–º","–Ω–∞–∑—Ä–∞–Ω—å","–Ω–∏–∂–Ω–µ–≤–∞—Ä—Ç–æ–≤—Å–∫","–Ω–∏–∂–Ω–µ–∫–∞–º—Å–∫",
    "–Ω–∏–∫–æ–ª–∞–µ–≤—Å–∫-–Ω–∞-–∞–º—É—Ä–µ","–Ω–µ—Ä—é–Ω–≥—Ä–∏","–Ω–æ–≤–æ—Ä–æ—Å—Å–∏–π—Å–∫","–Ω–æ–≤–æ—á–µ—Ä–∫–∞—Å—Å–∫","–Ω–æ–≤–æ—à–∞—Ö—Ç–∏–Ω—Å–∫","–Ω–æ—Ä–∏–ª—å—Å–∫","–Ω—è—è–≥–∞–Ω—å","–æ–±–Ω–∏–Ω—Å–∫",
    "–æ–¥–∏–Ω—Ü–æ–≤–æ","–ø–µ—Ç—Ä–æ–ø–∞–≤–ª–æ–≤—Å–∫-–∫–∞–º—á–∞—Ç—Å–∫–∏–π","–ø—è—Ç–∏–≥–æ—Ä—Å–∫","—Ä–æ—Å–ª–∞–≤–ª—å","—Ä–æ—Å—Ç–æ–≤","—Ä—É–¥–Ω—ã–π","—Ä—ã–±–∏–Ω—Å–∫","—Å–∞–ª–∞–≤–∞—Ç","—Å–∞–ª–µ—Ö–∞—Ä–¥",
    "—Å–µ–≤–µ—Ä–æ–¥–≤–∏–Ω—Å–∫","—Å–µ–≤–µ—Ä—Å–∫","—Å–µ—Ä–≥–∏–µ–≤ –ø–æ—Å–∞–¥","—Å–µ—Ä–æ–≤","—Å–µ—Ä–ø—É—Ö–æ–≤","—Å–∏–º—Ñ–µ—Ä–æ–ø–æ–ª—å","—Å—Ç–∞–≤—Ä–æ–ø–æ–ª—å","—Å—Ç–µ—Ä–ª–∏—Ç–∞–º–∞–∫","—Ç–∞–≥–∏–ª –Ω–∏–∂–Ω–∏–π",
    "—Ç–æ–±–æ–ª—å—Å–∫","—Ç—É–∞–ø—Å–µ","—Ç—é–º–µ–Ω—å","—É–ª—å—è–Ω–æ–≤—Å–∫","—É—Ñ–∞","—É—Ö—Ç–∞","—Ñ–µ–æ–¥–æ—Å–∏—è","—Ö–∞–Ω—Ç—ã-–º–∞–Ω—Å–∏–π—Å–∫","—Ö–∏–º–∫–∏","—á–µ–±–æ–∫—Å–∞—Ä—ã",
    "—á–µ—Ä–∫–µ—Å—Å–∫","—á–µ—Ä–Ω–æ–≥–æ—Ä—Å–∫","—à–∏–º–∞–Ω–æ–≤—Å–∫","—ç–Ω–≥–µ–ª—å—Å","—é–∂–Ω–æ-—Å–∞—Ö–∞–ª–∏–Ω—Å–∫","–∞–ª–µ–∫—Å–∏–Ω","–∞–ª—É—à—Ç–∞","–∞—Å–±–µ—Å—Ç","–∞—Ö—Ç—É–±–∏–Ω—Å–∫","–±–∞–ª–∞—à–∏—Ö–∞",
    "–±–∞—Ç–∞–π—Å–∫","–±–µ—Ä–µ–∑–Ω–∏–∫–∏","–±–æ—Ä","–±—É–¥—ë–Ω–Ω–æ–≤—Å–∫","–≥—É–±–∫–∏–Ω","–¥–º–∏—Ç—Ä–æ–≤","–¥–æ–º–æ–¥–µ–¥–æ–≤–æ","–µ–≥–æ—Ä—å–µ–≤—Å–∫","–∂–µ–ª–µ–∑–Ω–æ–≥–æ—Ä—Å–∫","–∑–µ–ª–µ–Ω–æ–≥—Ä–∞–¥",
    "–∑–µ–ª–µ–Ω–æ–¥–æ–ª—å—Å–∫","–∑–≤–µ–Ω–∏–≥–æ—Ä–æ–¥","–∫–∞–º—ã—à–ª–æ–≤","–∫–∏–Ω–µ—à–º–∞","–∫–∏—Å–µ–ª—ë–≤—Å–∫","–∫–ª–∏–Ω","–∫–æ–ª–ø–∏–Ω–æ","–∫—Ä–∞—Å–Ω–æ–∫–∞–º—Å–∫","–∫—Ä–æ–ø–æ—Ç–∫–∏–Ω","–∫—É–∑–Ω–µ—Ü–∫",
    "–∫—É–ø–∏–Ω–æ","–∫—É—Ä—á–∞—Ç–æ–≤","–ª—é–±–µ—Ä—Ü—ã","–º–∏–Ω–µ—Ä–∞–ª—å–Ω—ã–µ –≤–æ–¥—ã","–º–∏–∞—Å—Å","–Ω–æ–≤–æ–º–æ—Å–∫–æ–≤—Å–∫","–Ω–æ–≤–æ—Ç—Ä–æ–∏—Ü–∫","–Ω–æ–≤—ã–π —É—Ä–µ–Ω–≥–æ–π","–Ω–µ–≤–∏–Ω–Ω–æ–º—ã—Å—Å–∫",
    "–Ω–∞—Ö–∞–±–∏–Ω–æ","–ø—Ä–æ–∫–æ–ø—å–µ–≤—Å–∫","–ø—É—à–∫–∏–Ω–æ","—Ä–µ—É—Ç–æ–≤","—Ä—ã–±–Ω–æ–µ","—Å–∞—Ä–Ω—ã","—Å–µ—Ä–≥–∏–µ–≤—Å–∫","—Å–µ—Ä—Ç–æ–ª–æ–≤–æ","—Å–æ–ª–∏–∫–∞–º—Å–∫","—Å—Ç—É–ø–∏–Ω–æ",
    "—Ç–∞–ª–¥–æ–º","—Ç—Ä–æ–∏—Ü–∫","—Ñ—Ä—è–∑–∏–Ω–æ","—á–µ—Ä–Ω–æ–≥–æ–ª–æ–≤–∫–∞","—à–∞–¥—Ä–∏–Ω—Å–∫","—â—ë–ª–∫–æ–≤–æ","—ç–ª–µ–∫—Ç—Ä–æ—Å—Ç–∞–ª—å","—ç–ª–µ–∫—Ç—Ä–æ–≥–æ—Ä—Å–∫"
  ];
  const WORLD = [
    "–±–µ—Ä–ª–∏–Ω","–º—é–Ω—Ö–µ–Ω","–≥–∞–º–±—É—Ä–≥","–∫—ë–ª—å–Ω","–¥—é—Å—Å–µ–ª—å–¥–æ—Ä—Ñ","—à—Ç—É—Ç–≥–∞—Ä—Ç","–ø–∞—Ä–∏–∂","–ª–∏–æ–Ω","–º–∞—Ä—Å–µ–ª—å","–Ω–∏—Ü—Ü–∞","–º–∞–¥—Ä–∏–¥","–±–∞—Ä—Å–µ–ª–æ–Ω–∞",
    "–≤–∞–ª–µ–Ω—Å–∏—è","—Å–µ–≤–∏–ª—å—è","–ª–∏—Å—Å–∞–±–æ–Ω","–ø–æ—Ä—Ç—É","—Ä–∏–º","–º–∏–ª–∞–Ω","—Ç—É—Ä–∏–Ω","—Ñ–ª–æ—Ä–µ–Ω—Ü–∏—è","–Ω–µ–∞–ø–æ–ª—å","–≤–µ–Ω–µ—Ü–∏—è","–≥–µ–Ω—É—è","–≤–∞—Ä—à–∞–≤–∞",
    "–∫—Ä–∞–∫–æ–≤","–≤—Ä–æ—Ü–ª–∞–≤","–ø–æ–∑–Ω–∞–Ω—å","–≥–¥–∞–Ω—å—Å–∫","–ª–æ–¥–∑—å","–≤–µ–Ω–∞","–≥—Ä–∞—Ü","—Å–∞–ª—Ü–±—É—Ä–≥","–±—Ä—é—Å—Å–µ–ª—å","–∞–Ω—Ç–≤–µ—Ä–ø–µ–Ω","–∞–º—Å—Ç–µ—Ä–¥–∞–º","—Ä–æ—Ç—Ç–µ—Ä–¥–∞–º",
    "–≥–∞–∞–≥–∞","—É—Ç—Ä–µ—Ö—Ç","–∫–æ–ø–µ–Ω–≥–∞–≥–µ–Ω","—Å—Ç–æ–∫–≥–æ–ª—å–º","–º–∞–ª—å–º—ë","–æ—Å–ª–æ","–±–µ—Ä–≥–µ–Ω","—Ö–µ–ª—å—Å–∏–Ω–∫–∏","—Ç–∞–ª–ª–∏–Ω","—Ä–∏–≥–∞","–≤–∏–ª—å–Ω—é—Å","—Ä–µ–π–∫—å—è–≤–∏–∫",
    "–ª–æ–Ω–¥–æ–Ω","–º–∞–Ω—á–µ—Å—Ç–µ—Ä","–ª–∏–≤–µ—Ä–ø—É–ª—å","—ç–¥–∏–Ω–±—É—Ä–≥","–≥–ª–∞–∑–≥–æ","–¥—É–±–ª–∏–Ω","–±–µ–ª—Ñ–∞—Å—Ç","–∫–∞—Ä–¥–∏—Ñ—Ñ","–∞—Ñ–∏–Ω—ã","—Å–∞–ª–æ–Ω–∏–∫–∏","–±—É—Ö–∞—Ä–µ—Å—Ç",
    "—Å–æ—Ñ–∏—è","–±—É–¥–∞–ø–µ—à—Ç","–±—Ä–∞—Ç–∏—Å–ª–∞–≤–∞","–ª—é–±–ª—è–Ω–∞","–∑–∞–≥—Ä–µ–±","–ø—Ä–∏—à—Ç–∏–Ω–∞","—Å–∞—Ä–∞–µ–≤–æ","–ø—Ä–∞–≥–∞","–∞–Ω–¥–æ—Ä—Ä–∞-–ª–∞-–≤–µ–ª—å—è","—Å–∞–Ω-–º–∞—Ä–∏–Ω–æ",
    "–º–æ–Ω–∞–∫–æ","–ª—é–∫—Å–µ–º–±—É—Ä–≥","–≤–∞—à–∏–Ω–≥—Ç–æ–Ω","–Ω—å—é-–π–æ—Ä–∫","–±–æ—Å—Ç–æ–Ω","—Ñ–∏–ª–∞–¥–µ–ª—å—Ñ–∏—è","–º–∞–π–∞–º–∏","—á–∏–∫–∞–≥–æ","–¥–µ—Ç—Ä–æ–π—Ç","–¥–µ–Ω–≤–µ—Ä","—Ñ–∏–Ω–∏–∫—Å",
    "–ª–æ—Å-–∞–Ω–¥–∂–µ–ª–µ—Å","—Å–∏—ç—Ç–ª","—Å–∞–Ω-–¥–∏–µ–≥–æ","—Å–∞–Ω-—Ö–æ—Å–µ","—Å–∞–Ω-–∞–Ω—Ç–æ–Ω–∏–æ","–¥–∞–ª–ª–∞—Å","—Ö—å—é—Å—Ç–æ–Ω","–ª–∞—Å-–≤–µ–≥–∞—Å","–º–µ—Ö–∏–∫–æ","–≥—É–∞–¥–∞–ª–∞—Ö–∞—Ä–∞",
    "–º–æ–Ω—Ç–µ—Ä—Ä–µ–π","–æ—Ç—Ç–∞–≤–∞","—Ç–æ—Ä–æ–Ω—Ç–æ","–º–æ–Ω—Ä–µ–∞–ª—å","–≤–∞–Ω–∫—É–≤–µ—Ä","–∫–≤–µ–±–µ–∫","–±—É—ç–Ω–æ—Å-–∞–π—Ä–µ—Å","–∫–æ—Ä–¥–æ–≤–∞","—Ä–æ—Å–∞—Ä–∏–æ","—Å–∞–Ω—Ç—å—è–≥–æ","–ª–∏–º–∞",
    "–±–æ–≥–æ—Ç–∞","–º–µ–¥–µ–ª—å–∏–Ω","–∫–∏—Ç–æ","–≥—É–∞—è–∫–∏–ª—å","–∫–∞—Ä–∞–∫–∫–∞—Å","—Ä–∏–æ-–¥–µ-–∂–∞–Ω–µ–π—Ä–æ","—Å–∞–Ω-–ø–∞—É–ª—É","–±—Ä–∞–∑–∏–ª–∏–∞","—Å–∞–ª—å–≤–∞–¥–æ—Ä","–∫—É—Ä–∏—Ç–∏–±–∞",
    "–ø–µ–∫–∏–Ω","—à–∞–Ω—Ö–∞–π","–≥—É–∞–Ω—á–∂–æ—É","—à—ç–Ω—å—á–∂—ç–Ω—å","–Ω–∞–Ω—å–∫–∏–Ω","—Ç—è–Ω—å—Ü–∑–∏–Ω—å","—É—Ö–∞–Ω—å","—á—ç–Ω–¥—É","—Å–∏–∞–Ω—å","—á—É–Ω—Ü–∏–Ω","—Ç–æ–∫–∏–æ","–π–æ–∫–æ–≥–∞–º–∞",
    "–æ—Å–∞–∫–∞","–Ω–∞–≥–æ—è","—Å–∞–ø–ø–æ—Ä–æ","—Ñ—É–∫—É–æ–∫–∞","—Å–µ—É–ª","–ø—É—Å–∞–Ω","–∏–Ω—á—Ö–æ–Ω","–¥—ç–≥—É","–º–∞–Ω–∏–ª–∞","–±–∞–Ω–≥–∫–æ–∫","—Ö–æ–Ω–∫–æ–Ω–≥","—Å–∏–Ω–≥–∞–ø—É—Ä",
    "–∫—É–∞–ª–∞-–ª—É–º–ø—É—Ä","–¥–∂–∞–∫–∞—Ä—Ç–∞","—Å—É—Ä–∞–±–∞—è","–¥–µ–ª–∏","–º—É–º–±–∞–∏","–∫–æ–ª–∫–∞—Ç–∞","—á–µ–Ω–Ω–∞–π","–±–∞–Ω–≥–∞–ª–æ—Ä","–ª–∞—Ö–æ—Ä","–∏—Å–ª–∞–º–∞–±–∞–¥","–∫–∞–±—É–ª",
    "—Ç–µ–≥–µ—Ä–∞–Ω","–¥—É–±–∞–π","–∞–±—É-–¥–∞–±–∏","–¥–æ—Ö–∞","—ç—Ä-—Ä–∏—è–¥","–¥–∂–∏–¥–¥–∞","–∞–º–º–∞–Ω","–∏–µ—Ä—É—Å–∞–ª–∏–º","—Ç–µ–ª-–∞–≤–∏–≤","—Å—Ç–∞–º–±—É–ª","–∞–Ω–∫–∞—Ä–∞","–∏–∑–º–∏—Ä",
    "–∫–∞–∏—Ä","–∞–ª–µ–∫—Å–∞–Ω–¥—Ä–∏—è","—Ö–∞—Ä—Ç—É–º","–∞–¥–¥–∏—Å-–∞–±–µ–±–∞","–ª–∞–≥–æ—Å","–∞–±–∏–¥–∂–∞–Ω","–Ω–∞–π—Ä–æ–±–∏","–¥–∞—Ä-—ç—Å-—Å–∞–ª–∞–º","–∫–∞–ø—à—Ç–∞–¥—Ç","–π–æ—Ö–∞–Ω–Ω–µ—Å–±—É—Ä–≥",
    "—Ä–∞–±–∞—Ç","–∫–∞—Å–∞–±–ª–∞–Ω–∫–∞","—Ç—É–Ω–∏—Å","–∞–ª–∂–∏—Ä","—Å–∏–¥–Ω–µ–π","–º–µ–ª—å–±—É—Ä–Ω","–±—Ä–∏—Å–±–µ–Ω","–ø–µ—Ä—Ç","–∞–¥–µ–ª–∞–∏–¥–∞","–≤–µ–ª–ª–∏–Ω–≥—Ç–æ–Ω","–æ–∫–ª–µ–Ω–¥","–∫–∞–Ω–±–µ—Ä—Ä–∞"
  ];
  const CITIES = new Set([...RU, ...WORLD].map(s => s.toLowerCase().replaceAll("—ë","–µ").replace(/\s+/g," ").trim()).filter(Boolean));

  // ====== –£–¢–ò–õ–ò–¢–´ ======
  const normalize = s => s.toLowerCase().replaceAll("—ë","–µ").replace(/[¬´¬ª"']/g,"").replace(/\s+/g," ").trim();
  const lastSignificant = (s)=>{
    s = normalize(s);
    for (let i=s.length-1;i>=0;i--){
      let ch = s[i];
      if (!/[–∞-—è\- ]/.test(ch)) continue;
      if ("—å—ä—ã".includes(ch)) continue;
      if (ch==="–π") return "–∏";
      return ch;
    }
    return "";
  };
  const firstSignificant = (s)=>{ s = normalize(s).replace(/^-|^ /,""); let ch = s[0]; return ch==="–π"?"–∏":ch; };
  const capitalize = s => s.length ? s[0].toUpperCase()+s.slice(1) : s;
  const $ = sel => document.querySelector(sel);

  // ====== UI ======
  const input = $("#input"), submit=$("#submit"), statusEl=$("#status"),
        lastComp=$("#lastComp"), needEl=$("#need"), scoreEl=$("#score"), bestEl=$("#best"),
        historyEl=$("#history"), lastChainEl=$("#lastChain"), newGameBtn=$("#newGame"),
        toggleHintsBtn=$("#toggleHints");

  let used = new Set();
  let score = 0;
  let best = +(localStorage.getItem("cities-best")||0);
  bestEl.textContent = best;
  let hintsOn = false;

  // ====== –¢–ï–ú–ê (–≤ –≤—ã–ø–∞–¥–∞—é—â–µ–º –º–µ–Ω—é) ======
  const themeSel = $("#theme");
  const menu = document.querySelector('.menu');
  function applyTheme(mode){
    document.documentElement.setAttribute("data-theme", mode);
    localStorage.setItem("cities-theme", mode);
    if(mode==="system"){ document.documentElement.setAttribute("data-theme","system"); }
  }
  (function initTheme(){
    const saved = localStorage.getItem("cities-theme") || "system";
    if (themeSel) { themeSel.value = saved; }
    applyTheme(saved);
    const mq = window.matchMedia("(prefers-color-scheme: dark)");
    mq.addEventListener("change", ()=>{ if((localStorage.getItem("cities-theme")||"system")==="system") applyTheme("system"); });
  })();
  if (themeSel){
    themeSel.addEventListener("change", ()=> { applyTheme(themeSel.value); if(menu) menu.open=false; });
  }
  // –ó–∞–∫—Ä—ã–≤–∞—Ç—å –º–µ–Ω—é –ø–æ –∫–ª–∏–∫—É –ø–æ —Å—Å—ã–ª–∫–µ
  document.querySelectorAll('.menu nav a').forEach(a=> a.addEventListener('click', ()=>{ if(menu) menu.open=false; }));

  // ====== –ò–ì–†–û–í–ê–Ø –õ–û–ì–ò–ö–ê ======
  function resetGame(){
    used.clear();
    score = 0; scoreEl.textContent = "0";
    historyEl.innerHTML = "";
    input.classList.remove("ok","bad");
    const pool = Array.from(CITIES).filter(c=>!used.has(c));
    const start = pool[Math.floor(Math.random()*pool.length)];
    commitComp(start);
    statusEl.textContent = "–í–∞—à —Ö–æ–¥. –í–≤–µ–¥–∏—Ç–µ –≥–æ—Ä–æ–¥ –Ω–∞ –±—É–∫–≤—É: " + needEl.textContent.toUpperCase();
    input.focus();
    renderChain();
  }

  function commitComp(city){
    const n = normalize(city);
    used.add(n);
    lastComp.textContent = capitalize(city);
    const needed = lastSignificant(n);
    needEl.textContent = needed || "‚Äî";
    addHistory("–ö–æ–º–ø—å—é—Ç–µ—Ä", city);
  }

  function commitUser(city){
    const n = normalize(city);
    used.add(n);
    addHistory("–í—ã", city);
    score++; scoreEl.textContent = String(score);
    if (score>best){ best=score; bestEl.textContent=String(best); localStorage.setItem("cities-best", String(best)); }
  }

  function addHistory(who, city){
    const p = document.createElement("p");
    p.innerHTML = `<b>${who}:</b> ${capitalize(city)}`;
    historyEl.appendChild(p);
    historyEl.scrollTop = historyEl.scrollHeight;
  }

  function isValidCity(inputCity){
    const n = normalize(inputCity);
    if (!/^[–∞-—è\- ]{2,}$/.test(n)) return [false,"–¢–æ–ª—å–∫–æ —Ä—É—Å—Å–∫–∏–µ –±—É–∫–≤—ã (–Ω–∞–∑–≤–∞–Ω–∏—è –Ω–∞ —Ä—É—Å—Å–∫–æ–º)."];
    if (used.has(n)) return [false,"–≠—Ç–æ—Ç –≥–æ—Ä–æ–¥ —É–∂–µ –±—ã–ª."];
    if (!CITIES.has(n)) return [false,"–ù–µ –Ω–∞—à—ë–ª —Ç–∞–∫–æ–π –≥–æ—Ä–æ–¥ –≤ —Å–ø–∏—Å–∫–µ. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –¥—Ä—É–≥–æ–π."];
    const need = needEl.textContent;
    if (need && need!=="‚Äî" && firstSignificant(n)!==need) return [false,`–ù—É–∂–Ω–æ –Ω–∞ ¬´${need.toUpperCase()}¬ª.`];
    return [true,""];
  }

  function computerReply(){
    const needed = lastSignificant(normalize(input.value)) || needEl.textContent;
    const options = Array.from(CITIES).filter(c=>!used.has(c) && firstSignificant(c)===needed);
    if (options.length===0){
      statusEl.textContent = "–û—Ç–ª–∏—á–Ω–æ! –í–∞—Ä–∏–∞–Ω—Ç–æ–≤ –Ω–µ –æ—Å—Ç–∞–ª–æ—Å—å. –†–∞—É–Ω–¥ –∑–∞–≤–µ—Ä—à—ë–Ω.";
      return;
    }
    const pick = options[Math.floor(Math.random()*options.length)];
    commitComp(pick);
    statusEl.textContent = "–í–∞—à —Ö–æ–¥. –í–≤–µ–¥–∏—Ç–µ –≥–æ—Ä–æ–¥ –Ω–∞ –±—É–∫–≤—É: " + needEl.textContent.toUpperCase();
    renderChain();
  }

  function submitCity(){
    const v = input.value.trim();
    if (!v){ input.focus(); return; }
    const [ok, msg] = isValidCity(v);
    if (ok){
      input.classList.remove("bad"); input.classList.add("ok");
      commitUser(v);
      setTimeout(()=>{ input.classList.remove("ok"); input.value=""; computerReply(); }, 240);
    } else {
      input.classList.remove("ok"); input.classList.add("bad");
      statusEl.textContent = msg;
      setTimeout(()=> input.classList.remove("bad"), 800);
    }
  }

  // ====== –ü–û–î–°–ö–ê–ó–ö–ò ======
  function renderChain(){
    const needed = needEl.textContent;
    if (!needed || needed==="‚Äî"){ lastChainEl.textContent = ""; return; }
    const variants = Array.from(CITIES).filter(c=>!used.has(c) && firstSignificant(c)===needed);
    lastChainEl.innerHTML = variants.length
      ? `<span>–ü–æ–¥—Ö–æ–¥—è—Ç, –Ω–∞–ø—Ä–∏–º–µ—Ä: ${variants.slice(0,12).map(capitalize).join(", ")}${variants.length>12?"‚Ä¶":""}</span>`
      : `<span>–í–∞—Ä–∏–∞–Ω—Ç–æ–≤ –±–æ–ª—å—à–µ –Ω–µ—Ç ‚Äî –≤—ã –ø–æ–±–µ–¥–∏–ª–∏ –≤ —Ä–∞—É–Ω–¥–µ! üéâ</span>`;
    if (hintsOn) lastChainEl.classList.add("show");
  }

  toggleHintsBtn.addEventListener("click", ()=>{
    hintsOn = !hintsOn;
    toggleHintsBtn.textContent = hintsOn ? "–°–∫—Ä—ã—Ç—å –ø–æ–¥—Å–∫–∞–∑–∫–∏" : "–ü–æ–∫–∞–∑–∞—Ç—å –ø–æ–¥—Å–∫–∞–∑–∫–∏";
    lastChainEl.classList.toggle("show", hintsOn);
  });

  // ====== –°–ª—É—à–∞—Ç–µ–ª–∏ ======
  input.addEventListener("keydown", e=>{ if (e.key==="Enter") submitCity(); });
  submit.addEventListener("click", submitCity);
  newGameBtn.addEventListener("click", resetGame);

  // —Å—Ç–∞—Ä—Ç
  resetGame();

})();
</script>
</body>
</html>