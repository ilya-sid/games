<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>–ú–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ç—Ä–µ–Ω–∞–∂—ë—Ä</title>
  <style>
    :root {
      --bg: #0f1320;
      --card: #161a2b;
      --text: #e7eaf6;
      --muted: #a9b0c7;
      --ok: #1f9d55;
      --bad: #e11d48;
      --accent: #5b7cfa;
      --border: rgba(255,255,255,.12);
    }
    [data-theme="light"] {
      --bg: #f5f5f5;
      --card: #ffffff;
      --text: #222;
      --muted: #555;
      --ok: #1f9d55;
      --bad: #e11d48;
      --accent: #3b5bdb;
      --border: rgba(0,0,0,.12);
    }

    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, "Noto Sans", "Helvetica Neue", Arial;
      background: var(--bg);
      color: var(--text);
      display: grid;
      place-items: center;
      padding: 24px;
    }

    .wrap { width: min(880px, 100%); }
    .card {
      position: relative;
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 18px;
      padding: 22px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.25);
    }

    /* ===== –í—ã–ø–∞–¥–∞—é—â–µ–µ –º–µ–Ω—é (–ò–≥—Ä—ã + –¢–µ–º–∞) ===== */
    .menu {
      position: absolute;
      top: 12px;
      right: 12px;
      z-index: 2;
    }
    .menu summary {
      list-style: none;
      cursor: pointer;
      background: var(--accent);
      color: #fff;
      border: 0;
      padding: 8px 12px;
      border-radius: 12px;
      font-weight: 700;
      box-shadow: 0 6px 16px rgba(0,0,0,.2);
    }
    .menu summary::-webkit-details-marker { display: none; }
    .menu[open] summary { filter: brightness(.95); }
    .menuPanel {
      margin-top: 8px;
      right: 0;
      position: absolute;
      min-width: 240px;
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 14px;
      padding: 10px;
      box-shadow: 0 16px 40px rgba(0,0,0,.35);
    }
    .menu h4 {
      margin: 6px 8px 6px;
      font-size: 13px;
      color: var(--muted);
      text-transform: uppercase;
      letter-spacing: .06em;
    }
    .menu a {
      display: block;
      padding: 8px 10px;
      color: var(--text);
      text-decoration: none;
      border-radius: 10px;
    }
    .menu a:hover { background: rgba(127,127,127,.12); }
    .themeRow {
      display: grid;
      grid-template-columns: 1fr;
      gap: 8px;
      padding: 6px 8px 4px;
    }
    .themeRow select {
      background: #131a31;
      color: var(--text);
      border-radius: 10px;
      padding: 8px 10px;
      border: 1px solid var(--border);
      font-size: 14px;
    }
    [data-theme="light"] .themeRow select { background: #fff; color: #000; border: 1px solid #ccc; }

    h1 { margin: 0 0 8px; font-size: clamp(22px, 4.3vw, 34px); }
    .sub { color: var(--muted); margin-bottom: 20px; font-size: 14px; }

    .task {
      font-variant-numeric: tabular-nums;
      font-weight: 700;
      font-size: clamp(28px, 7vw, 56px);
      text-align: center;
      background: var(--bg);
      border-radius: 14px;
      padding: clamp(12px, 3vw, 24px);
      border: 1px solid var(--border);
    }

    .io { display: grid; grid-template-columns: 1fr auto; gap: 10px; margin-top: 14px; }

    input[type="text"] {
      width: 100%;
      font-size: clamp(22px, 5.2vw, 32px);
      padding: 14px 16px;
      border-radius: 12px;
      border: 2px solid transparent;
      outline: none;
      color: var(--text);
      background: #10162a;
    }
    [data-theme="light"] input[type="text"] { background: #f0f0f0; color: #000; }
    input.ok { border-color: var(--ok); }
    input.bad { border-color: var(--bad); }

    button {
      font-size: 16px; font-weight: 700;
      padding: 14px 18px; border-radius: 12px; cursor: pointer;
      border: 0; color: white; background: var(--accent);
    }

    .feedback { margin-top: 12px; font-size: 16px; }
    .good { color: var(--ok); font-weight: 700; }
    .badt { color: var(--bad); font-weight: 700; }

    .stats { display: grid; grid-template-columns: repeat(4,1fr); gap: 8px; margin-top: 12px; }
    .stat { background: var(--bg); border-radius: 10px; padding: 10px; text-align:center; }
    .stat b { display:block; font-size: 18px; }

    .controls { margin-top: 16px; display: flex; justify-content: space-between; align-items: center; gap: 10px; }
    /* –£–±—Ä–∞–ª–∏ –æ—Ç–¥–µ–ª—å–Ω—ã–π –≤—ã–ø–∞–¥–∞—é—â–∏–π —Å–ø–∏—Å–æ–∫ —Ç–µ–º—ã –æ—Ç—Å—é–¥–∞ ‚Äî –æ–Ω —Ç–µ–ø–µ—Ä—å –≤ –º–µ–Ω—é */
    select#difficulty {
      background: #131a31; color: var(--text); border-radius: 10px; padding: 6px 10px; font-size: 14px; border: 1px solid var(--border);
    }
    [data-theme="light"] select#difficulty { background: #fff; color: #000; border: 1px solid #ccc; }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <!-- –í—ã–ø–∞–¥–∞—é—â–µ–µ –º–µ–Ω—é: –∏–≥—Ä—ã + —Å–∫—Ä—ã—Ç—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Ç–µ–º—ã -->
      <details class="menu">
        <summary>–ú–µ–Ω—é ‚ñæ</summary>
        <div class="menuPanel" role="menu">
          <h4>–ò–≥—Ä—ã</h4>
          <nav>
            <a href="index.html">üßÆ –ü—Ä–∏–º–µ—Ä—ã (—Ç—Ä–µ–Ω–∞–∂—ë—Ä)</a>
            <a href="battleship.html">üö¢ –ú–æ—Ä—Å–∫–æ–π –±–æ–π</a>
            <a href="cities.html">üåç –ì–æ—Ä–æ–¥–∞</a>
            <a href="minesweeper.html">üí£ –°–∞–ø—ë—Ä</a>
            <a href="tictactoe.html">‚ùå‚≠ï –ö—Ä–µ—Å—Ç–∏–∫–∏-–Ω–æ–ª–∏–∫–∏</a>
          </nav>
          <h4>–¢–µ–º–∞</h4>
          <div class="themeRow">
            <select id="theme" aria-label="–¢–µ–º–∞ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è">
              <option value="dark">–¢—ë–º–Ω–∞—è</option>
              <option value="light">–°–≤–µ—Ç–ª–∞—è</option>
              <option value="auto" selected>–ö–∞–∫ –Ω–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ</option>
            </select>
          </div>
        </div>
      </details>

      <h1>–ú–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ç—Ä–µ–Ω–∞–∂—ë—Ä</h1>
      <div class="sub">–£—Ä–æ–≤–µ–Ω—å: <span id="levelLabel">–õ—ë–≥–∫–∏–π</span></div>

      <div class="task" id="task">‚Äî</div>

      <div class="io">
        <input id="answer" type="text" inputmode="numeric" autocomplete="off" placeholder="–í–∞—à –æ—Ç–≤–µ—Ç" />
        <button id="check">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å</button>
      </div>

      <div class="feedback" id="feedback"></div>

      <div class="stats">
        <div class="stat"><span>–í—Å–µ–≥–æ</span><b id="sTotal">0</b></div>
        <div class="stat"><span>–í–µ—Ä–Ω–æ</span><b id="sRight">0</b></div>
        <div class="stat"><span>–°–µ—Ä–∏—è</span><b id="sStreak">0</b></div>
        <div class="stat"><span>–¢–æ—á–Ω–æ—Å—Ç—å</span><b id="sAcc">0%</b></div>
      </div>

      <div class="controls">
        <select id="difficulty" aria-label="–°–ª–æ–∂–Ω–æ—Å—Ç—å">
          <option value="easy">–õ—ë–≥–∫–∏–π</option>
          <option value="medium">–°—Ä–µ–¥–Ω–∏–π</option>
          <option value="hard">–°–ª–æ–∂–Ω—ã–π</option>
        </select>
        <!-- –¢–µ–º–∞ –ø–µ—Ä–µ–µ—Ö–∞–ª–∞ –≤ –º–µ–Ω—é -->
      </div>
    </div>
  </div>

  <script>
  (function(){
    const taskEl = document.getElementById('task');
    const answerEl = document.getElementById('answer');
    const feedbackEl = document.getElementById('feedback');
    const checkBtn = document.getElementById('check');

    const sTotal = document.getElementById('sTotal');
    const sRight = document.getElementById('sRight');
    const sStreak = document.getElementById('sStreak');
    const sAcc = document.getElementById('sAcc');

    const difficulty = document.getElementById('difficulty');
    const levelLabel = document.getElementById('levelLabel');

    // –¢–µ–º–∞ —Ç–µ–ø–µ—Ä—å –±–µ—Ä—ë—Ç—Å—è –∏–∑ —Å–µ–ª–µ–∫—Ç–∞ –≤–Ω—É—Ç—Ä–∏ –º–µ–Ω—é
    const themeSelect = document.getElementById('theme');
    const menu = document.querySelector('.menu');

    let current=null, total=0, right=0, streak=0;

    function randInt(a, b){ return Math.floor(Math.random()*(b-a+1))+a; }
    function pick(arr){ return arr[Math.floor(Math.random()*arr.length)]; }

    function genTask(mode){
      let a,b,ans,op;
      if(mode==='easy'){
        a=randInt(1,99); b=randInt(1,99); op=pick(['+','-']);
      } else if(mode==='medium'){
        a=randInt(1,99); b=randInt(1,99); op=pick(['+','-','√ó','√∑']);
      } else {
        a=randInt(1,999); b=randInt(1,999); op=pick(['+','-','√ó','√∑']);
      }

      if(op==='√∑'){
        // –¥–µ–ª–µ–Ω–∏–µ —Å —Ü–µ–ª—ã–º –æ—Ç–≤–µ—Ç–æ–º
        let divisor=b===0?1:b;
        let quotient=randInt(1,10);
        a=divisor*quotient; b=divisor; ans=quotient;
        return { text:`${a} √∑ ${b} = ?`, answer:ans };
      }
      if(op==='+') ans=a+b;
      if(op==='-'){ if(b>a) [a,b]=[b,a]; ans=a-b; }
      if(op==='√ó') ans=a*b;
      return { text:`${a} ${op} ${b} = ?`, answer:ans };
    }

    function nextTask(){
      answerEl.classList.remove('ok','bad');
      feedbackEl.textContent='';
      answerEl.value='';
      current=genTask(difficulty.value);
      taskEl.textContent=current.text;
      answerEl.focus();
    }

    function updateStats(){
      sTotal.textContent=total;
      sRight.textContent=right;
      sStreak.textContent=streak;
      sAcc.textContent= total? Math.round(right/total*100)+'%':'0%';
    }

    function check(){
      if(!current) return;
      let val=answerEl.value.trim();
      if(val==='') return;
      total++;
      let user=Number(val);
      if(user===current.answer){
        right++; streak++;
        feedbackEl.innerHTML='<span class="good">–ü—Ä–∞–≤–∏–ª—å–Ω–æ!</span>';
        answerEl.classList.add('ok');
        setTimeout(nextTask,700);
      } else {
        streak=0;
        feedbackEl.innerHTML='<span class="badt">–ù–µ–≤–µ—Ä–Ω–æ. –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç: '+current.answer+'</span>';
        answerEl.classList.add('bad');
      }
      updateStats();
    }

    answerEl.addEventListener('keydown',e=>{ if(e.key==='Enter') check(); });
    checkBtn.addEventListener('click',check);

    difficulty.addEventListener('change',()=>{
      levelLabel.textContent=difficulty.options[difficulty.selectedIndex].text;
      nextTask();
    });

    // ===== –¢–µ–º–∞ –≤ –º–µ–Ω—é =====
    function applyThemeSelect(val){
      if(val==='dark'){document.body.dataset.theme='dark';}
      else if(val==='light'){document.body.dataset.theme='light';}
      else {
        // system
        if(window.matchMedia('(prefers-color-scheme: light)').matches){
          document.body.dataset.theme='light';
        } else {
          document.body.dataset.theme='dark';
        }
      }
      localStorage.setItem('trainer-theme', val);
    }
    // –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
    (function initTheme(){
      const saved = localStorage.getItem('trainer-theme') || 'auto';
      themeSelect.value = saved;
      applyThemeSelect(saved);
      // –º–µ–Ω—è—Ç—å –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å–∏—Å—Ç–µ–º–Ω–æ–π —Ç–µ–º—ã, –µ—Å–ª–∏ –≤—ã–±—Ä–∞–Ω "auto"
      const mqLight = window.matchMedia('(prefers-color-scheme: light)');
      mqLight.addEventListener('change', ()=> {
        if((localStorage.getItem('trainer-theme')||'auto')==='auto') applyThemeSelect('auto');
      });
    })();
    themeSelect.addEventListener('change', ()=>{
      applyThemeSelect(themeSelect.value);
      // –∑–∞–∫—Ä—ã—Ç—å –º–µ–Ω—é –ø–æ—Å–ª–µ –≤—ã–±–æ—Ä–∞ —Ç–µ–º—ã
      menu.open = false;
    });

    // –ó–∞–∫—Ä—ã–≤–∞—Ç—å –º–µ–Ω—é –ø–æ –∫–ª–∏–∫—É –ø–æ —Å—Å—ã–ª–∫–µ
    document.querySelectorAll('.menu a').forEach(a=>{
      a.addEventListener('click', ()=> { menu.open = false; });
    });

    nextTask();
    updateStats();
  })();
  </script>
</body>
</html>
